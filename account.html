<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tài khoản – Review Map 247</title>

<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;}
  body{
    background:#eef3fb;
    color:#111827;
    min-height:100vh;
  }

  /* ===== Header / Toolbar (mới) ===== */
  header{
    background:linear-gradient(90deg,#ffffff,#f8fafc);
    border-bottom:1px solid rgba(15,23,42,0.04);
    position:relative;
    z-index:60;
    box-shadow: 0 1px 0 rgba(255,255,255,0.6) inset;
    min-height:64px;
    padding:0;
  }

  /* logo left */
  .brand{
    position:absolute;
    left:16px;
    top:12px;
    display:flex;
    align-items:center;
    gap:10px;
    text-decoration:none;
    color:inherit;
    z-index:70;
  }
  .brand .mark{
    width:36px;height:36px;border-radius:8px;
    background:linear-gradient(135deg,#2b6ef6,#7c3aed);
    display:flex;align-items:center;justify-content:center;
    color:white;font-weight:700;font-size:16px;
    box-shadow:0 6px 18px rgba(20,20,50,0.06);
  }
  .brand .title{
    font-weight:800;
    color:#d30000;
    font-size:16px;
    white-space:nowrap;
  }

  /* centered menu */
  nav.menu{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    display:flex;
    align-items:center;
    gap:12px;
    z-index:60;
  }
  nav.menu a{
    display:flex;
    align-items:center;
    gap:8px;
    padding:8px 12px;
    border-radius:10px;
    text-decoration:none;
    color:#4b5563;
    background:transparent;
    transition:background .12s ease, transform .12s ease;
    border:1px solid transparent;
    font-weight:600;
  }
  nav.menu a .ico{ width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;font-size:14px;color:#6b7280; }
  nav.menu a span{ color:#6b7280; font-weight:600; font-size:14px; white-space:nowrap; }
  nav.menu a:hover{
    background:rgba(43,110,246,0.06);
    transform:translateY(-2px);
    border-color:rgba(43,110,246,0.08);
    color:#111827;
  }
  nav.menu a.active{
    color:#e11d48;
    font-weight:700;
    background:rgba(225,29,72,0.06);
  }
  .divider{
    height:28px;width:1px;background:rgba(15,23,42,0.04);
    margin:0 6px;border-radius:1px;
  }

  /* balance pill (căn giữa theo chiều cao header ở phải) */
  .balance-pill{
    position:absolute;
    top:50%;
    right:18px;
    transform:translateY(-50%);
    background:#ffffff;
    padding:6px 12px;
    border-radius:999px;
    font-size:13px;
    font-weight:700;
    box-shadow:0 6px 16px rgba(15,23,42,0.1);
    border:1px solid #e5e7eb;
    display:flex;
    align-items:center;
    gap:8px;
    z-index:65;
  }
  .btn-topup{
    border:none;
    padding:4px 8px;
    border-radius:999px;
    font-size:12px;
    font-weight:700;
    cursor:pointer;
    background:#2563eb;
    color:#ffffff;
    transition:.2s;
  }
  .btn-topup:hover{ background:#1d4ed8; }

  /* LAYOUT CHUNG (giữ nguyên phần còn lại, chỉ đặt sau header mới) */
  .page-wrap{
    max-width:1100px;
    margin:26px auto 40px;
    padding:0 16px;
  }
  .grid-2{
    display:grid;
    grid-template-columns:2fr 1.4fr;
    gap:18px;
    margin-bottom:18px;
  }
  @media(max-width:900px){
    .grid-2{grid-template-columns:1fr;}
  }

  .card{
    background:#ffffff;
    border-radius:6px;
    border:1px solid #e5e7eb;
    box-shadow:0 10px 25px rgba(15,23,42,0.08);
    padding:18px 20px 20px;
    margin-bottom:18px;
  }
  .card-title{
    font-size:15px;
    font-weight:700;
    margin-bottom:14px;
  }

  .row{
    display:grid;
    grid-template-columns:repeat(2,minmax(0,1fr));
    gap:10px 16px;
    margin-bottom:8px;
  }
  .field-label{
    font-size:13px;
    color:#4b5563;
    margin-bottom:4px;
  }
  input[type="text"],
  input[type="email"],
  input[type="password"]{
    width:100%;
    padding:8px 10px;
    border-radius:4px;
    border:1px solid #d1d5db;
    font-size:14px;
    background:#f9fafb;
    outline:none;
  }
  input:focus{
    background:#ffffff;
    border-color:#60a5fa;
    box-shadow:0 0 0 1px rgba(59,130,246,.3);
  }
  input[disabled]{
    background:#f9fafb;
    color:#6b7280;
  }

  /* Token + nút copy */
  .token-wrap{
    display:flex;
    gap:8px;
    margin-top:6px;
  }
  .token-wrap input{
    flex:1;
  }
  .btn{
    border:none;
    padding:8px 14px;
    border-radius:4px;
    font-size:13px;
    font-weight:700;
    cursor:pointer;
    transition:.2s;
  }
  .btn-primary{
    background:#2563eb;
    color:#ffffff;
  }
  .btn-primary:hover{
    background:#1d4ed8;
  }
  .note{
    margin-top:6px;
    font-size:12px;
    color:#b91c1c;
  }

  /* LỊCH SỬ BẢNG */
  .table-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:10px;
    font-size:13px;
    color:#4b5563;
  }
  .table-header select,
  .table-header input{
    padding:6px 8px;
    border-radius:4px;
    border:1px solid #d1d5db;
    font-size:13px;
    background:#f9fafb;
  }

  table{
    width:100%;
    border-collapse:collapse;
    font-size:13px;
  }
  th,td{
    padding:8px 10px;
    border-bottom:1px solid #e5e7eb;
    text-align:left;
  }
  th{
    background:#f9fafb;
    font-weight:700;
    color:#4b5563;
    font-size:12px;
  }
  .table-footer{
    margin-top:6px;
    font-size:12px;
    color:#6b7280;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .pager{
    display:flex;
    gap:6px;
  }
  .pager button{
    padding:4px 8px;
    border-radius:4px;
    border:1px solid #d1d5db;
    background:#fff;
    cursor:pointer;
    font-size:12px;
  }

  /* TOAST IOS-STYLE */
  .toast{
    position:fixed;
    right:18px;
    bottom:18px;
    background:rgba(255,255,255,0.9);
    backdrop-filter:blur(16px);
    -webkit-backdrop-filter:blur(16px);
    border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,0.18);
    border:1px solid rgba(0,0,0,0.05);
    padding:10px 16px;
    display:flex;
    align-items:center;
    gap:8px;
    font-size:13px;
    font-weight:600;
    color:#111827;
    opacity:0;
    transform:translateY(20px);
    pointer-events:none;
    transition:.35s cubic-bezier(0.16,1,0.3,1);
    z-index:999;
  }
  .toast.show{
    opacity:1;
    transform:translateY(0);
    pointer-events:auto;
  }
  .toast-icon{font-size:16px;}

  @media (max-width:880px){
    nav.menu a span{display:none}
    .brand .title{font-size:15px}
    .balance-pill{display:none}
  }
  @media (max-width:520px){
    header{ padding:8px 10px; min-height:56px; }
  }
</style>
</head>
<body>

<!-- NEW HEADER -->
<header>
  <a href="shop.html" class="brand" title="Về trang chính">
    <div class="mark">RM</div>
    <div class="title">Review Map 24H</div>
  </a>

  <nav class="menu" role="navigation" aria-label="Thanh điều hướng">
    <a href="shop.html" class="nav-item" title="Tạo Đơn review map">
      <i class="fa-solid fa-map-location-dot"></i>
      <span>Tạo Đơn review map</span>
    </a>
    <a href="account.html" class="nav-item active" title="Tài Khoản">
      <i class="fa-solid fa-user"></i>
      <span>Tài Khoản</span>
    </a>
    <a href="topup.html" class="nav-item" title="Nạp Tiền">
      <i class="fa-solid fa-wallet"></i>
      <span>Nạp Tiền</span>
    </a>
    <a href="history.html" class="nav-item" title="Lịch Sử Đơn">
      <i class="fa-solid fa-clock-rotate-left"></i>
      <span>Lịch Sử Đơn</span>
    </a>
    <div class="divider" aria-hidden="true"></div>
    <a href="contact.html" class="nav-item admin-link" title="Liên Hệ Admin">
      <i class="fa-solid fa-circle-info"></i>
      <span>Liên Hệ Admin</span>
    </a>
    <a href="login.html" class="nav-item logout" id="btnLogout" title="Đăng Xuất">
      <i class="fa-solid fa-right-from-bracket"></i>
      <span>Đăng Xuất</span>
    </a>
  </nav>

  <div class="balance-pill" aria-hidden="true">
    Số dư: <span id="balanceAmount">0 đ</span>
    <button type="button" class="btn-topup" id="btnGoTopup">Nạp tiền</button>
  </div>
</header>

<div class="page-wrap">

  <!-- HÀNG ĐẦU: THÔNG TIN + ĐỔI MẬT KHẨU -->
  <div class="grid-2">
    <!-- Thông tin tài khoản -->
    <div class="card">
      <div class="card-title">Thông tin tài khoản</div>
      <div class="row">
        <div>
          <div class="field-label">Tài khoản</div>
          <input type="text" id="accUsername" disabled>
        </div>
        <div>
          <div class="field-label">Địa chỉ e-mail</div>
          <input type="email" id="accEmail" disabled>
        </div>
        <div>
          <div class="field-label">Cấp bậc</div>
          <input type="text" id="accRank" disabled>
        </div>
        <div>
          <div class="field-label">Cập nhật</div>
          <input type="text" id="accUpdated" disabled>
        </div>
        <div>
          <div class="field-label">Số dư</div>
          <input type="text" id="accBalance" disabled>
        </div>
        <div>
          <div class="field-label">Tổng nạp</div>
          <input type="text" id="accTotal" disabled>
        </div>
      </div>

      <div class="field-label">Access Token</div>
      <div class="token-wrap">
        <input type="text" id="accToken" readonly>
        <button class="btn btn-primary" id="btnCopyToken">Sao chép</button>
      </div>
      <div class="note">
        * Nếu lộ token hãy đổi mật khẩu ngay để tránh mất tiền!
      </div>
    </div>

    <!-- Thay đổi mật khẩu -->
    <div class="card">
      <div class="card-title">Thay Đổi Mật Khẩu</div>
      <div class="row">
        <div style="grid-column:1/-1">
          <div class="field-label">Mật khẩu cũ</div>
          <input type="password" id="oldPass" placeholder="Nhập mật khẩu cũ">
        </div>
        <div style="grid-column:1/-1">
          <div class="field-label">Mật khẩu mới</div>
          <input type="password" id="newPass" placeholder="Nhập mật khẩu mới">
        </div>
        <div style="grid-column:1/-1">
          <div class="field-label">Nhập lại mật khẩu mới</div>
          <input type="password" id="confirmPass" placeholder="Nhập lại mật khẩu mới">
        </div>
      </div>
      <button class="btn btn-primary" id="btnChangePass" style="margin-top:6px;">Cập nhật ngay</button>
    </div>
  </div>

  <!-- Lịch sử giao dịch -->
  <div class="card">
    <div class="card-title">Lịch Sử Giao Dịch</div>
    <div class="table-header">
      <div>Show
        <select>
          <option>10</option><option>25</option><option>50</option>
        </select> entries
      </div>
      <div>
        <input type="text" placeholder="Tìm kiếm...">
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Tài khoản</th>
          <th>Mã giao dịch</th>
          <th>Số dư trước</th>
          <th>Giao dịch</th>
          <th>Số dư sau</th>
          <th>Nội dung</th>
          <th>Thời gian</th>
        </tr>
      </thead>
      <tbody id="txBody">
        <tr><td colspan="8" style="text-align:center;color:#6b7280;">No data available in table</td></tr>
      </tbody>
    </table>
    <div class="table-footer">
      <span>Showing 0 to 0 of 0 entries</span>
      <div class="pager">
        <button disabled>Previous</button>
        <button disabled>Next</button>
      </div>
    </div>
  </div>

  <!-- Lịch sử hoạt động -->
  <div class="card">
    <div class="card-title">Lịch Sử Hoạt Động</div>
    <div class="table-header">
      <div>Show
        <select>
          <option>10</option><option>25</option><option>50</option>
        </select> entries
      </div>
      <div><input type="text" placeholder="Search..."></div>
    </div>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Tài khoản</th>
          <th>Nội dung</th>
          <th>Địa chỉ IP</th>
          <th>Thời gian</th>
        </tr>
      </thead>
      <tbody id="logBody">
        <tr><td colspan="5" style="text-align:center;color:#6b7280;">No data available in table</td></tr>
      </tbody>
    </table>
    <div class="table-footer">
      <span>Showing 0 to 0 of 0 entries</span>
      <div class="pager">
        <button disabled>Previous</button>
        <button disabled>Next</button>
      </div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
  <span class="toast-icon" id="toastIcon"></span>
  <span id="toastMsg">Message</span>
</div>

<script>
  // ===== Render balance & setup topup (kept minimal; logout handled by existing listener below) =====
  (function(){
    const balanceSpan = document.getElementById('balanceAmount');
    const btnTopup = document.getElementById('btnGoTopup');

    const currentUser = localStorage.getItem('currentUser');
    let users = JSON.parse(localStorage.getItem('users') || '[]');
    let me = users.find(u => u.username === currentUser) || { balance: 0 };

    function formatVND(n){ return Number(n||0).toLocaleString('vi-VN') + ' đ'; }
    if(balanceSpan) balanceSpan.textContent = formatVND(me.balance || 0);

    if(btnTopup){
      btnTopup.addEventListener('click', ()=> window.location.href = 'topup.html');
    }
  })();
</script>

<script>
  // ===== LẤY USER HIỆN TẠI =====
  const currentUser = localStorage.getItem('currentUser');
  if(!currentUser){
    alert('Bạn cần đăng nhập!');
    window.location.href = 'login.html';
  }

  let users = JSON.parse(localStorage.getItem('users') || '[]');
  let me = users.find(u => u.username === currentUser);

  if(!me){
    alert('Không tìm thấy tài khoản, đăng nhập lại!');
    localStorage.removeItem('currentUser');
    window.location.href = 'login.html';
  }

  // Gán các giá trị mặc định nếu thiếu
  if(!me.email) me.email = currentUser + '@gmail.com';
  if(!me.rank) me.rank = 'Nhà Quảng Cáo';
  if(typeof me.balance !== 'number') me.balance = 0;
  if(typeof me.totalDeposit !== 'number') me.totalDeposit = 0;
  if(!me.token){
    me.token = Math.random().toString(36).substring(2) +
               Math.random().toString(36).substring(2,10);
  }
  localStorage.setItem('users', JSON.stringify(users));

  // Hiển thị thông tin
  document.getElementById('accUsername').value = currentUser;
  document.getElementById('accEmail').value    = me.email;
  document.getElementById('accRank').value     = me.rank;
  document.getElementById('accBalance').value  = me.balance.toLocaleString('vi-VN') + ' đ';
  document.getElementById('accTotal').value    = me.totalDeposit.toLocaleString('vi-VN') + ' đ';
  document.getElementById('accToken').value    = me.token;
  document.getElementById('accUpdated').value  =
    new Date().toLocaleString('vi-VN');

  // ===== TOAST =====
  const toast = document.getElementById('toast');
  const toastIcon = document.getElementById('toastIcon');
  const toastMsg  = document.getElementById('toastMsg');
  let toastTimer = null;

  function showToast(message, type='success'){
    toast.className = 'toast';
    toast.classList.add('show');
    if(type==='success'){
      toastIcon.textContent = '✅';
    }else if(type==='error'){
      toastIcon.textContent = '❌';
    }else{
      toastIcon.textContent = '⚠️';
    }
    toastMsg.textContent = message;
    if(toastTimer) clearTimeout(toastTimer);
    toastTimer = setTimeout(()=> toast.classList.remove('show'), 2600);
  }

  // Copy token
  document.getElementById('btnCopyToken').addEventListener('click', () => {
    const tokenInput = document.getElementById('accToken');
    tokenInput.select();
    tokenInput.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(tokenInput.value)
      .then(()=> showToast('Đã sao chép token!', 'success'))
      .catch(()=> showToast('Không sao chép được token', 'error'));
  });

  // Đổi mật khẩu
  document.getElementById('btnChangePass').addEventListener('click', () => {
    const oldPass = document.getElementById('oldPass').value.trim();
    const newPass = document.getElementById('newPass').value.trim();
    const confirm = document.getElementById('confirmPass').value.trim();

    if(!oldPass || !newPass || !confirm){
      showToast('Vui lòng điền đủ 3 ô mật khẩu!', 'warning');
      return;
    }
    if(oldPass !== me.password){
      showToast('Mật khẩu cũ không đúng!', 'error');
      return;
    }
    if(newPass.length < 6){
      showToast('Mật khẩu mới phải ≥ 6 ký tự!', 'warning');
      return;
    }
    if(newPass !== confirm){
      showToast('Mật khẩu nhập lại không khớp!', 'error');
      return;
    }

    me.password = newPass;
    localStorage.setItem('users', JSON.stringify(users));
    document.getElementById('oldPass').value = '';
    document.getElementById('newPass').value = '';
    document.getElementById('confirmPass').value = '';
    showToast('Cập nhật mật khẩu thành công!', 'success');
  });

  // Logout
  document.getElementById('btnLogout').addEventListener('click', (e)=>{
    e.preventDefault();
    localStorage.removeItem('currentUser');
    window.location.href = 'login.html';
  });
</script>

</body>
</html>
